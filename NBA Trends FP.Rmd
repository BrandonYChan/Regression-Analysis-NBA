---
title: "Regression Analysis on NBA Claims"
author: "Brandon Chan, Brayden Van De Wynckel"
date: "2024-11-13"
output: html_document
---

```{r setup, include=FALSE} 
knitr::opts_chunk$set(echo = TRUE)
# install.packages("MASS") 
# install.packages("leaps") 

library(MASS)
library(tidyverse)
library(leaps) 
select <- dplyr::select 
```

# Objective  
Many older NBA fans like to make claims about how the league was different back in their day. They often criticize today's game and make claims such as 'players are too soft to play in the post and only shoot threes nowadays'. The aim of this analysis is to see how the game has changed, and why some of these changes have taken place.
# Data Description 
The data is from basketballreference.com. They offer CSV files that are free to download on their website. This particular dataset includes many common stats (ex. points, offensive rating), taken as the league average of per-game stats of teams for a given season. For example the PTS stat in the 2023-24 season represents that average points per game scored by a team in a single game.
```{r}
league_df <- read_csv("https://raw.githubusercontent.com/BrandonYChan/ballindata/refs/heads/master/static/CSV/League/per100_league.csv") %>%
  filter(Season >="1950-51") %>% 
  select(-c(Rk, Lg))
league_df 
```

The following is a breakdown of each category within the dataset.
Rk (Rank): The sequential ranking of each season's data entry.
Season: The specific NBA season (e.g., 2023-24).
Lg (League): The basketball league, typically "NBA".
Age: The average age of players in the league for that season.
Ht (Height): The average height of players, typically represented in feet and inches.
Wt (Weight): The average weight of players in pounds.
G (Games): The total number of games played in the season.
MP (Minutes Played): The average total minutes played per game by all teams combined.
FG (Field Goals): The average number of field goals made per game.
FGA (Field Goal Attempts): The average number of field goal attempts per game.
X3P (3-Point Field Goals): The average number of 3-point field goals made per game.
X3PA (3-Point Attempts): The average number of 3-point field goal attempts per game.
FT (Free Throws): The average number of free throws made per game.
FTA (Free Throw Attempts): The average number of free throw attempts per game.
ORB (Offensive Rebounds): The average number of offensive rebounds per game.
DRB (Defensive Rebounds): The average number of defensive rebounds per game.
TRB (Total Rebounds): The average number of total rebounds (offensive + defensive) per game.
AST (Assists): The average number of assists per game.
STL (Steals): The average number of steals per game.
BLK (Blocks): The average number of blocks per game.
TOV (Turnovers): The average number of turnovers per game.
PF (Personal Fouls): The average number of personal fouls per game.
PTS (Points): The average total points scored per game.
FG% (Field Goal Percentage): The shooting percentage for field goals (FG/FGA).
X3P% (3-Point Percentage): The shooting percentage for 3-point field goals (3P/3PA).
FT% (Free Throw Percentage): The shooting percentage for free throws (FT/FTA).
Pace: The average number of possessions per 48 minutes, indicating the speed of play.
eFG% (Effective Field Goal Percentage): A shooting metric that adjusts for the higher value of 3-point shots, calculated as (FG+0.5*P)/FGA
TOV% (Turnover Percentage): The percentage of possessions ending in turnovers.
ORB% (Offensive Rebound Percentage): The percentage of available offensive rebounds a team secures.
FT/FGA (Free Throw Attempts Per Field Goal Attempt): The ratio of free throw attempts to field goal attempts.
ORtg (Offensive Rating): The number of points scored per 100 possessions.
TS% (True Shooting Percentage): A measure of shooting efficiency that considers field goals, 3-point field goals, and free throws, calculated as PTS/(2*(FGA+0.44*FTA))

# EDA 
We are going to start by evaluating the claim that players shoot more 3's in today's game than in past decades. This can be expressed more formally with a hypothesis test. 

## Hypothesis Test:
Claim: Players shoot more threes in the current decade than in past decades. 
We will take the mean number of threes attempted in the 2020's and compare it to the mean number of threes in the 1990's as estimates. 

$$H_0$$: Mean # 3's in the 2020's ($$M_{2020s}$$) = Mean # 3s in the 1990's ($$M_{1990s}$$)
$$H_A$$: Mean # 3's in the 2020's > Mean # 3s in the 1990's 

$$t_{obs} = \frac{((M_{2020s} - M_{1990s})-0)}{\sqrt{\frac{\sigma_1^2}{n} + \frac{\sigma_2^2}{m}}}$$ 
$$t_{obs} = \frac{12.56 - 4.25}{\sqrt{\frac{0.3361547^2}{5} + \frac{1.726429^2}{10}}}$$ 

At 95% significance: $$t_{0.025, 4} = 2.131847$$
$$ t_{obs} > t_{\alpha, n-1} $$
So we reject the null hypothesis: Players do shoot more threes in the current decade than in the past. 



```{r}
# Group by decade 
df_3s <- league_df %>% 
  mutate(Decade = paste(substr(Season, 6, 6), "0's", sep=""))

# Get mean 3's for each decade 
decade3s <- df_3s %>% 
  group_by(Decade) %>% 
  summarise(Mean3s = mean(`3PA`)) %>% 
  arrange(desc(Mean3s)) 
decade3s 

mean3s_2020s <- decade3s %>% 
  filter(Decade=="20's") %>% 
  select(Mean3s) %>% 
  pull() 

means3s_1990s <- decade3s %>% 
  filter(Decade=="90's") %>% 
  select(Mean3s) %>% 
  pull() 

mu <- mean(decade3s$Mean3s)

sigma_1 <- df_3s %>% 
  filter(Decade=="20's") %>% 
  summarise(sd(`3PA`)) %>% 
  pull()
  
sigma_2 <- df_3s %>% 
  filter(Decade=="90's") %>% 
  summarise(sd(`3PA`)) %>% 
  pull()  


n <- df_3s %>% 
  filter(Decade=="20's") %>% 
  select(Decade) %>% 
  count() %>% 
  pull() 
m <- df_3s %>% 
  filter(Decade=="90's") %>% 
  select(Decade) %>% 
  count() %>% 
  pull() 

t_obs <- ((mean3s_2020s - means3s_1990s)-0)/sqrt(sigma_1^2/n + sigma_2^2/m) 
t_obs 

# Evaluated at 95% significance 
# qt(0.05, n-1, lower.tail = FALSE)
```

## Plotting Changes in 3-Pointers Made  
The evidence strongly suggests that players take more 3s than in the past. We verify this with a visualization: 
```{r}
df_3s <- league_df %>% 
  filter(!is.na(Pace), !is.na(`3PA`), !is.na(`3P%`)) %>% 
  select(Season,`3PA`, `3P%`) 

df_3s %>% 
  ggplot(aes(Season, `3PA`, group=1)) + 
  geom_point() + 
  geom_line() +
  scale_x_discrete(breaks=c("1979-80", "1989-90", "1999-00", "2009-10", "2019-20")) + 
  ggtitle("3-Pointers Made Per-Game Increases Almost Every Season") + 
  labs(caption = "3-pt line distance decreased from 1994 to 1997")

```
It is clear that players take more threes in almost every passing season since the addition of the three point line to the NBA game in 1979. This leads to the question; why are players taking more threes?

## Stat Selection to Predict Threes Made 
```{r}
df_pred3 <- league_df %>% 
  select(-c(Season, Ht, `3P`, `3P%`, FG, FGA, `FG%`, `FT/FGA`, `eFG%` ))
df_pred3 

# result.null <- lm(`3PA` ~ 1, df_pred3)
# result.full <- lm(`3PA` ~ ., df_pred3)
# step(result.null, scope=list(upper=result.full), data=df_pred3, direction="both")


best_subsets_3s <- regsubsets(`3PA`~., df_pred3, method="backward")   
best_summary_3s <- summary(best_subsets) 

plot(best_summary$bic, xlab = "Number of Variables", ylab = "BIC", type = "b")

coef(best_subsets_3s, 9)



```
## Creating the Model 
```{r}
model_3s <- lm(`3PA` ~ FT+FTA+DRB+AST+STL+TOV+PTS+`ORB%`+ORtg , df_pred3) 
summary(model_3s) 
```

## 
Regress defensive stats against 3 point attempts to see if better defense leads to more 3 point attempts

```{r}
lm_3s <- lm(`3PA`~STL+TOV+BLK, league_df)
summary(lm_3s)
```

```{r}
anova(lm_3s)
```

```{r}
confint(lm_3s, level=0.9)
```

```{r}
plot(league_df$STL, league_df$`3PA`)
abline(lm(`3PA`~STL, league_df))
```

```{r}
plot(league_df$TOV, league_df$`3PA`)
abline(lm(`3PA`~TOV, league_df))
```

```{r}
  plot(league_df$BLK, league_df$`3PA`)
abline(lm(`3PA`~BLK, league_df))
```

Based on this output, the opposite appears to be true. As defence gets better 3 point appempts go down. This could also be that due to better defence, teams feel less safe taking deeper shots as well as open shots being much less frequent, fewer 3 point attempts are made.

